import torch
import time
from transformers import AutoModelForCausalLM, AutoTokenizer, pipeline

torch.random.manual_seed(0)

model_path = "microsoft/Phi-4-mini-instruct"

model = AutoModelForCausalLM.from_pretrained(
    model_path,
    torch_dtype="auto",
    trust_remote_code=True,
)
model.to("cuda")
tokenizer = AutoTokenizer.from_pretrained(model_path)



messages = [
    {"role": "system", "content": """ยินดีต้อนรับสู่ห้องสมุดแห่งความลับของนิวท์ สคามันเดอร์!
ข้าคือ ศาสตราจารย์ผู้เชี่ยวชาญด้านสัตว์มหัศจรรย์แห่งโลกเวทมนตร์ นักสำรวจสายเลือดมักมายผู้ตามรอยการเดินทางของนิวท์ สคามันเดอร์ และเป็นผู้
เขียนร่วมในฉบับปรับปรุงของตำราสัตว์มหัศจรรย์และถิ่นที่อยู่! """},
    {"role": "user", "content": """คำถามจากนักเรียนผู้กล้าหาญ:
"ฉันอยากเสี่ยงสัตววิเศษที่ ที่เป็นมิตร ต่อพ่อมด อาศัยอยู่ในนํ้า ชอบกินผักขม มีตัวอะไรเเนะนำบ้าง?"

ตำราโบราณเปิดออก... เสียงกระซิบจากหน้ากระดาษเล่าเรื่องราวต่อไปนี้...

บันทึกลับของ กัปปะ (Kappa)
ชื่อ : กัปปะ (Kappa)
สีผิว : มีเกล็ด
ถิ่นกำเนิด : ญี่ปุ่น
ลักษณะเด่น : มีแอ่งเว้าใส่น้ำอยู่กลางกระหม่อม กินเลือดมนุษย์
หนังสือที่เกี่ยวข้อง : สัตว์มหัศจรรย์และถิ่นที่อยู่
ความเกี่ยวพัน : ศาสตร์มืด
ประเภทที่ กระทรวงเวทมนตร์. จัดไว้ : ไม่สามารถฝึกหรือเลี้ยงไว้ในครัวเรือนได้เลยอันตราย/ต้องใช้ความรู้ของผู้เชี่ยวชาญ/พ่อมดที่มีทักษะสูงสา
มารถรับมือได้ (XXXX)
สถานะ : ยังคงมีอยู่

กัปปะ เป็นปีศาจน้ำญี่ปุ่น อาศัยอยู่ตามบ่อน้ำตื้น ๆ และแม่น้ำ คนมักจะมองว่ากัปปะคล้ายลิง แต่มีเกล็ดปลาอยู่ตามตัวแทนที่จะเป็นขน และมีแอ่งเ
ว้าใส่น้ำอยู่กลางกระหม่อม

กัปปะกินเลือดมนุษย์ แต่ถ้าโยนแตงกวาที่สลักชื่อคนให้มัน กัปปะก็จะไม่ทําร้ายคนคนนั้น เมื่อเผชิญหน้ากัปปะ พ่อมดควรล่อหลอกให้มันโค้งตัวลง ซึ่งจะทําให้น้ำที่อยู่บนหัวหกลงมา แล้วกัปปะก็จะสูญสิ้นเรี่ยวแรงทั้งหมด

เสียงกระซิบจากนักเรียนฮอกวอตส์ว่าได้เห็นสัตว์ชนิดนี้ในป่าต้องห้าม...

บันทึกลับของ กรินดี้โลว์ (Grindylow)
ชื่อ : กรินดี้โลว์ (Grindylow)
สีตา : เหลือง ขาว เขียว
สีผิว : เขียวขี้ม้าออกไปทางซีด
ถิ่นกำเนิด : ทะเลสาบทั่วเกาะบริเตนใหญ่และไอร์แลนด์
ลักษณะเด่น : มีเขาแหลมเล็กบนหัว ลักษณะก้าวร้าว อาศัยในน้ำ กินเนื้อเป็นอาหาร
ขนาดตัวโตเต็มวัย : เล็กกว่าห้าฟุต
หนังสือที่เกี่ยวข้อง : สัตว์มหัศจรรย์และถิ่นที่อยู่
ความเกี่ยวพัน : ชาวเงือก, ศาสตร์มืด
ประเภทที่ กระทรวงเวทมนตร์. จัดไว้ : พ่อมดที่มีความสามารถทั่วไปสามารถรับมือได้
สถานะ : ยังคงมีอยู่

กรินดี้โลว์ เป็นปีศาจน้ำตัวสีเขียวซีดและมีเขา พบได้ตามทะเลสาบทั่วอังกฤษและไอร์แลนด์ กินปลาตัวเล็กและตะไคร่น้ำเป็นอาหาร อย่างไรก็ตาม ในบา
งครั้งพวกมันก็กินมนุษย์ (ด้วยเหตุนี้จึงถูกจัดให้เป็นสิ่งมีชีวิตที่เกี่ยวข้องกับศาสตร์มืด) กรินดี้โลว์ดุร้ายกับพ่อมดและมักเกิ้ลพอ ๆ กัน แ
ต่ชาวเงือกจะทำให้พวกมันเชื่องได้ ชาวเงือกจึงมักเลี้ยงกรินดี้โลว์ไว้เป็นสัตว์เลี้ยง กรินดี้โลว์มีนิ้วที่ยาวมาก ซึ่งแม้จะใช้ยึดจับอะไรได้เ
หนียวแน่น แต่ก็เปราะและหักได้ง่ายดาย

พ่อมดแม่มดมักใช้คาถาแทงปฏัก รับมือกับพวกปีศาจน้ำตัวเขียว เนื่องจากคาถามีผลบังคับให้คนหรือสิ่งของนั้น ๆ ปล่อยสิ่งที่ฉวยหรือกำไว้ด้วยการปล
่อยประกายเป็นไฟ ใช้ได้ทั้งบนบกและใต้น้ำ หากใช้ใต้น้ำประกายไฟจะถูกเปลี่ยนเป็นน้ำร้อนแทน

กรินดี้โลว์มีชื่อเรียกที่แตกต่างกันไปในแต่ละพื้นที่ อาทิเช่น “โพลลี่วิกเกิล” ในเมืองอิลคลีย์ หรือ “แคนดี้โพล” ในแถบหมู่บ้านแคทเทิลเวลล์ 
เมืองยอร์กเชียร์ และ “จาร์วิส” ในเมืองเชฟฟิลด์

ลือกันว่ามีพ่อมดคนหนึ่งเคยเลี้ยงสัตว์ชนิดนี้และค้นพบความลับที่น่าทึ่ง...

บันทึกลับของ กลัมบัมเบิล (Glumbumble)
ชื่อ : กลัมบัมเบิล (Glumbumble)
สีผิว : เทา
ถิ่นกำเนิด : แถบยุโรปตอนเหนือ
ลักษณะเด่น : แมลงบินได้ ตัวสีเทา มีขนปุกปุย
หนังสือที่เกี่ยวข้อง : สัตว์มหัศจรรย์และถิ่นที่อยู่
ประเภทที่ กระทรวงเวทมนตร์. จัดไว้ : อันตราย/ต้องใช้ความรู้ของผู้เชี่ยวชาญ/พ่อมดที่มีทักษะสูงสามารถรับมือได้ พ่อมดที่มีความสามารถทั่วไปสา
มารถรับมือได้ (XXX)
สถานะ : ยังคงมีอยู่


กลัมบัมเบิล (Glumbumble) พบได้ในแถบยุโรปตอนเหนือ เป็นแมลงบินได้ ตัวสีเทาขนปุกปุย มันจะผลิตน้ำหวานที่มีสรรพคุณช่วยลดความเศร้าสร้อยได้ น้ำ
หวานนี้ใช้เป็นยาแก้โรคประสาทที่เกิดจากการกินใบอะลิฮอตซีเข้าไป บางครั้งกลัมบัมเบิลอาจบุกเข้าไปอยู่ในรังผึ้ง ทำให้น้ำผึ้งมีสรรพคุณแปลก ๆ ก
ลัมบัมเบิลมักทำรังอยู่ตามที่มืด ๆ ห่างไกลจากผู้คน เช่น ตามโพรงต้นไม้และถ้ำ มันกินต้นตำแยเป็นอาหาร

ในปี ค.ศ. 1989-1990 ชั้นเรียนวิชาดูแลสัตว์วิเศษของโรงเรียนฮอกวอตส์ ได้นำกลัมบัมเบิลมาเป็นหนึ่งในบทเรียนสำหรับนักเรียนชั้นปีที่หก โดยมีวิ
ลเฮลมิน่า กรับบลี-แพลงก์ อาจารย์ดูแลสัตว์วิเศษในขณะนั้นเป็นผู้สอน

มีตำนานโบราณกล่าวว่าสัตว์ชนิดนี้มีพลังวิเศษที่ยังไม่ถูกค้นพบ...



คำปรึกษาจากที่ปรึกษาแห่งกระทรวงเวทมนตร์
- ตอบคำถามโดยใช้ความรู้เฉพาะจากตำราที่เปิดออกเท่านั้น
- หากมีสัตว์มหัศจรรย์ที่เข้าเกณฑ์ของนักเรียน ให้แนะนำอย่างเฉพาะเจาะจง
- อธิบายทั้งประโยชน์และอันตรายที่อาจเกิดขึ้น - เพราะทุกสิ่งในโลกเวทมนตร์มีสองด้านเสมอ
- บอกเล่าเคล็ดลับในการเข้าถึงและดูแลสัตว์วิเศษที่แนะนำ ซึ่งเป็นความรู้ที่ถ่ายทอดจากรุ่นสู่รุ่น
- หากไม่มีสัตว์ที่ตรงตามความต้องการทั้งหมด ให้แนะนำตัวที่ใกล้เคียงที่สุดและเหตุผล

คำตอบจากผู้พิทักษ์ความลับแห่งสัตว์มหัศจรรย์:
"""},
]

pipe = pipeline(
    "text-generation",
    model=model,
    tokenizer=tokenizer,
)
generation_args = {
    "max_new_tokens": 500,
    "return_full_text": False,
    "temperature": 0.0,
    "do_sample": False,
}

# หากใช้งาน GPU ให้เรียก synchronize เพื่อรอให้ทุกงานเสร็จสิ้น
if torch.cuda.is_available():
    torch.cuda.synchronize()

# เริ่มจับเวลา
start_time = time.time()

output = pipe(messages, **generation_args)

end_time = time.time()
execution_time = end_time - start_time

print(output[0]['generated_text'])
print(f"Execution time: {execution_time:.2f} seconds")

